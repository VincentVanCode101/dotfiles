#!/bin/bash

usage() {
  echo "Usage: $0 <directory-to-scan>"
  echo "  <directory-to-scan>: Path to the directory to scan for leaks."
  exit 1
}

if [ $# -eq 0 ] || [ -z "$1" ]; then
  echo "Error: No directory provided."
  usage
fi

if [ ! -d "$1" ]; then
  echo "Error: Directory '$1' does not exist."
  usage
fi

docker run --rm -v "$1":/path zricethezav/gitleaks:latest detect --source="/path" -v -r gitleaks.json

if [ $? -ne 0 ]; then
  echo "Error: Gitleaks failed to process the directory."
  exit 1
else
  echo "Gitleaks scan completed successfully. Results are in gitleaks.json."
fi
